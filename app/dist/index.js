(()=>{"use strict";var e={873:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AssertionType=void 0;class r{}t.AssertionType=r,r.CONSOLE_OUTPUT="console-output",r.FILE_OUTPUT="file-output",r.FILE_UPDATE="file-update",r.FILE_DELETE="file-delete",r.values=[r.CONSOLE_OUTPUT,r.FILE_OUTPUT,r.FILE_UPDATE,r.FILE_DELETE]},102:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.BbtContext=void 0;const s=i(r(147)),c=i(r(17)),a=r(129);t.BbtContext=class{constructor(e){if(this.defPath=e||c.resolve(".")+"/bbtdef.json",this.rootPath=c.dirname(this.defPath)+"/",this.workPath=__dirname+"/../work/",this.def=JSON.parse(s.readFileSync(this.defPath,"utf-8")),this.resourcePath=this.rootPath+this.def.resource,this.envPath=this.workPath+"env/",!(0,a.isBbtDef)(this.def))throw Error("The bbt definition's format is invalid.")}}},129:(e,t)=>{function r(e){let t=void 0!==e.name&&void 0!==e.command&&void 0!==e.expected;if(t){let r=e.expected;e.name?e.command?Array.isArray(r)?t=t&&r.every(n):o("expected"):o("command"):o("name")}return t}function n(e){const t=void 0!==e.act&&void 0!==e.value;return t&&(e.act?e.value||o("value"):o("act")),t}function o(e){return new Error("The ["+e+"] field must be non null.")}Object.defineProperty(t,"__esModule",{value:!0}),t.isCheck=t.isCmdDef=t.isBbtDef=void 0,t.isBbtDef=function(e){let t=void 0!==e.need&&void 0!==e.resource&&void 0!==e.operations;if(t){let n=e.operations;Array.isArray(n)?t=t&&n.every(r):o("operations")}return t},t.isCmdDef=r,t.isCheck=n},703:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return o(t,e),t},s=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{a(n.next(e))}catch(e){i(e)}}function c(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,c)}a((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const c=i(r(147)),a=i(r(17)),u=r(102),f=r(224),d=r(873);let l;(function(){return s(this,void 0,void 0,(function*(){const e=new u.BbtContext(process.argv[2]);if(l=e.workPath,c.existsSync(l))throw Error("May be working other process just now.");c.mkdirSync(l),function(e){if(new Set(e.def.operations.map((e=>e.name))).size!=e.def.operations.length)throw Error("The operation's name must not be duplicated.");e.def.operations.forEach((t=>{return r=t,n=e.resourcePath,void r.expected.forEach((e=>{if(!d.AssertionType.values.includes(e.act))throw Error("Invalid act type is found. The operation's name is ["+r.name+"].");if(e.act==d.AssertionType.FILE_OUTPUT&&!c.existsSync(n+"/output/"+e.value))throw Error("Resource files lack. The operation's name is ["+r.name+"].");if(!(e.act!=d.AssertionType.FILE_UPDATE||c.existsSync(n+"/input/"+e.value)&&c.existsSync(n+"/output/"+e.value)))throw Error("Resource files lack. The operation's name is ["+r.name+"].");if(e.act==d.AssertionType.FILE_DELETE&&!c.existsSync(n+"/input/"+e.value))throw Error("Resource files lack. The operation's name is ["+r.name+"].")}));var r,n}))}(e),function(e){c.mkdirSync(e.envPath),e.def.need.forEach((t=>{const r=e.rootPath+t;t.includes(a.sep)&&c.mkdirSync(e.envPath+a.parse(t).dir,{recursive:!0}),c.copyFileSync(r,e.envPath+t)}))}(e),yield(0,f.execSh)("ready",[l,e.defPath]).wait()}))})().catch((e=>{var t;void 0!==(t=e).code&&"string"==typeof t.code&&console.error("exit code -> "+e.code),console.error(e instanceof Error?e.message:e),l&&c.rmSync(l,{force:!0,recursive:!0}),process.exit(-1)}))},224:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{a(n.next(e))}catch(e){i(e)}}function c(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,c)}a((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.execSh=t.Ticket=void 0;const o=r(81),i=__dirname+"/sh/";class s{constructor(){this.end=!1,this.process=null}wait(){return n(this,void 0,void 0,(function*(){let e=!1;const t=(new Date).getTime();for(;!this.end&&!e;)yield c(.5),e=(new Date).getTime()-t>18e4}))}}function c(e){return new Promise((t=>setTimeout(t,1e3*e)))}t.Ticket=s,t.execSh=function(e,t=[]){let r=new s;return r.process=(0,o.exec)(i+e+".sh "+t.join(" "),{windowsHide:!0},((e,t,n)=>{if(e)throw e;if(n)throw Error(n.toString());t&&console.log(t),r.end=!0})),r}},81:e=>{e.exports=require("child_process")},147:e=>{e.exports=require("fs")},17:e=>{e.exports=require("path")}},t={};!function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n].call(i.exports,i,i.exports,r),i.exports}(703)})();