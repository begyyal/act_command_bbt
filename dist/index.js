(()=>{"use strict";var e={873:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AssertionType=void 0;class r{}t.AssertionType=r,r.CONSOLE_OUTPUT="console-output",r.FILE_OUTPUT="file-output",r.FILE_UPDATE="file-update",r.FILE_DELETE="file-delete",r.values=[r.CONSOLE_OUTPUT,r.FILE_OUTPUT,r.FILE_UPDATE,r.FILE_DELETE]},102:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&o(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.BbtContext=void 0;const s=i(r(147)),a=i(r(17)),c=r(129);t.BbtContext=class{constructor(e){const t=e||a.resolve(".")+"/bbtdef.json";if(this.rootPath=a.dirname(t),this.workPath=__dirname+"/work/",this.def=JSON.parse(s.readFileSync(t,"utf-8")),this.resourcePath=this.rootPath+this.def.resource,this.envPath=this.workPath+"/env/",!(0,c.isBbtDef)(this.def))throw Error("The bbt definition's format is invalid.")}}},129:(e,t)=>{function r(e){let t=void 0!==e.name&&void 0!==e.command&&void 0!==e.expected;if(t){let r=e.expected;e.name?e.command?Array.isArray(r)?t=t&&r.every(o):n("expected"):n("command"):n("name")}return t}function o(e){const t=void 0!==e.act&&void 0!==e.value;return t&&(e.act?e.value||n("value"):n("act")),t}function n(e){return new Error("The ["+e+"] field must be non null.")}Object.defineProperty(t,"__esModule",{value:!0}),t.isCheck=t.isCmdDef=t.isBbtDef=void 0,t.isBbtDef=function(e){let t=void 0!==e.need&&void 0!==e.resource&&void 0!==e.operations;if(t){let o=e.operations;Array.isArray(o)?t=t&&o.every(r):n("operations")}return t},t.isCmdDef=r,t.isCheck=o},703:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&o(t,e,r);return n(t,e),t},s=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(n,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const a=i(r(147)),c=i(r(17)),u=r(102),f=r(873);(function(){return s(this,void 0,void 0,(function*(){const e=new u.BbtContext(process.argv[2]);a.mkdirSync(e.workPath),function(e){if(new Set(e.def.operations.map((e=>e.name))).size!=e.def.operations.length)throw Error("The operation's name must not be duplicated.");e.def.operations.forEach((t=>{return r=t,o=e.resourcePath,void r.expected.forEach((e=>{if(!f.AssertionType.values.includes(e.act))throw Error("Invalid act type is found. The operation's name is ["+r.name+"].");if(e.act==f.AssertionType.FILE_OUTPUT&&!a.existsSync(o+"/output/"+e.value))throw Error("Resource files lack. The operation's name is ["+r.name+"].");if(!(e.act!=f.AssertionType.FILE_UPDATE||a.existsSync(o+"/input/"+e.value)&&a.existsSync(o+"/output/"+e.value)))throw Error("Resource files lack. The operation's name is ["+r.name+"].");if(e.act==f.AssertionType.FILE_DELETE&&!a.existsSync(o+"/input/"+e.value))throw Error("Resource files lack. The operation's name is ["+r.name+"].")}));var r,o}))}(e),function(e){a.mkdirSync(e.envPath),e.def.need.forEach((t=>{const r=e.rootPath+t;t.includes(c.sep)&&a.mkdirSync(e.envPath+c.parse(t).dir,{recursive:!0}),a.copyFileSync(r,c.parse(e.envPath+t).dir,a.constants.COPYFILE_FICLONE_FORCE)}))}(e),e.def.operations.forEach((e=>{})),a.rmSync(e.workPath,{force:!0,recursive:!0})}))})().catch((e=>{var t;void 0!==(t=e).code&&"string"==typeof t.code&&console.error("exit code -> "+e.code),console.error(e instanceof Error?e.message:e),process.exit(-1)}))},147:e=>{e.exports=require("fs")},17:e=>{e.exports=require("path")}},t={};!function r(o){var n=t[o];if(void 0!==n)return n.exports;var i=t[o]={exports:{}};return e[o].call(i.exports,i,i.exports,r),i.exports}(703)})();